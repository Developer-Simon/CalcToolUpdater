<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,300' rel='stylesheet' type='text/css'> -->
	<link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css" /> 
  <link rel="stylesheet" href="./index.scss">

  <title>CalculationToolClient</title>

  <script>let $ = jQuery = require('jquery');</script>
  <script>require('bootstrap');</script>
</head>
<body>
  <div class="center">
    <div class="container-fluid">
      <style type="text/css">
        button {
          margin-right: 5px;
        }
        h4 {
          padding: 4px
        }
      </style>
      <h4>Excel-AddIn Version</h4>
      <div class="alert alert-primary">
        <span id="addin-version">Keine Version installiert</span>
      </div>
      <h4>Verfügbare Version</h4>
      <div class="alert alert-primary">
        <span id="version_label">VX.Y.Z</span>
      </div>
      <div id="install-button-line">
        <button id="StartInstallButton" class="btn btn-primary">
          Verfügbare Version installieren
        </button>
      </div>
      <!--- <button id="DebugButton">Debugg-action</button> --->
      <br><br>
    </div>
    <div class="container-fluid" id="flex-update-download"></div>
    <div class="container-fluid" id="update-status"></div>
    <div class="container-fluid" id="message-viewer"></div>
  </div>
  <!-- Insert this line above script imports  -->
  <script>
    if (typeof module === 'object') {
      window.module = module; 
      module = undefined;
    }
  </script>

  <!-- normal script imports etc... -->
  <script>
    // Display the current version
    let version = window.location.hash.substring(1);
    document.getElementById('version_label').innerText = version;
  </script>

  <!-- Insert this line after script imports -->
  <script>
    if (window.module) {
      module = window.module;
    }
  </script>

  <!-- Electron Scripts -->
  <script type="text/javascript">
    // Create ipcRenderer
    const { ipcRenderer } = require('electron');

    // Create button event
    const installButton = document.getElementById('StartInstallButton');
    installButton.addEventListener('click', function() {
      var arg = "secondParam";
      ipcRenderer.send("installButton", arg);
    })

    // Create update listener
    ipcRenderer.on('message', function(event, text) {
      var container = document.getElementById('message-viewer');
      var message = document.createElement('div');
      message.innerHTML = text;
      container.appendChild(message);
    })

    // create update status listener
    ipcRenderer.on('update-status', function(event, text) {
      var message = document.getElementById('update-status');
      message.innerHTML = text;
    })

    // Create update button
    ipcRenderer.on('add-update-button', function(event, text) {
      var container = document.getElementById('flex-update-download');
      var label = document.createElement('div');
      var action = document.createElement('button');
      action.innerHTML = text;
      action.id = 'UpdateDownloadButton';
      label.innerText = 'Neue Version verfügbar: ';
      container.appendChild(label);
      container.appendChild(action);
      const updatebtnclick = document.getElementById('UpdateDownloadButton');
      updatebtnclick.addEventListener('click', function() {
        ipcRenderer.send("downloadUpdate");
      })

      container = document.getElementById('install-button-line');
      var childBefore = document.getElementById('StartInstallButton');
      var button = document.createElement('button');
      button.id = 'update-download-button';
      button.className = "btn btn-success";
      button.innerHTML = text;
      container.insertBefore(button, childBefore);
      button.addEventListener('click', function() {
        ipcRenderer.send('download-update-req')
      })
    })
  </script>
  <script>
    // debug button script - seperate script body for compiling issues  
    const debugbtnclick = document.getElementById('DebugButton');
    debugbtnclick.addEventListener('click', function() {
    ipcRenderer.send("debugbtnclick");
  })
  </script>
</body>
</html>