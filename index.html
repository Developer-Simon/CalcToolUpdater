<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,300' rel='stylesheet' type='text/css'>
	<title>CalculationToolClient</title>
</head>
<body>
  <main class="content-wraper" id="content-wraper">
    <div class="content-blk">
      Aktuelle Version:
      <br>
      <button id="StartInstallButton">
        <span id="version_label">VX.Y.Z</span> installieren
      </button>
      <!--- <button id="DebugButton">Debugg-action</button> --->
      <br><br>

    </div>
    <div id="flex-update-download"></div>
    <div id="update-status"></div>
    <div id="message-viewer"></div>
  </main>

  <!-- Insert this line above script imports  -->
  <script>
    if (typeof module === 'object') {
      window.module = module; 
      module = undefined;
    }
  </script>

  <!-- normal script imports etc... -->
  <script>
    // Display the current version
    let version = window.location.hash.substring(1);
    document.getElementById('version_label').innerText = version;
  </script>

  <!-- Insert this line after script imports -->
  <script>
    if (window.module) {
      module = window.module;
    }
  </script>

  <!-- Electron Scripts -->
  <script type="text/javascript">
    // Create ipcRenderer
    const { ipcRenderer } = require('electron');

    // Create button event
    const installButton = document.getElementById('StartInstallButton');
    installButton.addEventListener('click', function() {
      var arg = "secondParam";
      ipcRenderer.send("installButton", arg);
    })
    const debugbtnclick = document.getElementById('DebugButton');
    debugbtnclick.addEventListener('click', function() {
      ipcRenderer.send("debugbtnclick");
    })

    // Create update listener
    ipcRenderer.on('message', function(event, text) {
      var container = document.getElementById('message-viewer');
      var message = document.createElement('div');
      message.innerHTML = text;
      container.appendChild(message);
    })

    // create update status listener
    ipcRenderer.on('update-status', function(event, text) {
      var message = document.getElementById('update-status');
      message.innerHTML = text;
    })

    // Create update button
    ipcRenderer.on('add-update-button', function(event, text) {
      var container = document.getElementById('flex-update-download');
      var label = document.createElement('div');
      var action = document.createElement('button');
      action.innerHTML = text;
      action.id = 'UpdateDownloadButton';
      label.innerText = 'Neue Version verf√ºgbar: ';
      container.appendChild(label);
      container.appendChild(action);
      const updatebtnclick = document.getElementById('UpdateDownloadButton');
      updatebtnclick.addEventListener('click', function() {
        ipcRenderer.send("downloadUpdate");
      })
    })
  </script>
</body>
</html>